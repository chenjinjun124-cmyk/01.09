<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²é ˜æ½®æµ | å­¸ç”Ÿå–œå¥½åˆ†æå„€è¡¨æ¿</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; font-family: sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 1.5rem; transition: transform 0.3s; }
        .glass-card:hover { transform: translateY(-5px); }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body class="p-6 md:p-12">

    <div class="max-w-6xl mx-auto text-center mb-12" data-aos="fade-down">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">ğŸ¥¤ å­¸ç”Ÿé£²æ–™å–œå¥½æ•¸æ“šåˆ†æ</h1>
        <div id="status-tag" class="inline-block px-4 py-1 rounded-full bg-green-500 text-sm font-bold">ç³»çµ±é€£ç·šä¸­</div>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="glass-card p-8" data-aos="zoom-in">
            <h3 class="text-2xl font-bold mb-6 flex items-center">ğŸ“Š å¹´ç´šåˆ†ä½ˆ</h3>
            <div class="chart-container"><canvas id="gradeChart"></canvas></div>
        </div>

        <div class="glass-card p-8" data-aos="zoom-in" data-aos-delay="200">
            <h3 class="text-2xl font-bold mb-6 flex items-center">ğŸ¥— é£²é£Ÿç¿’æ…£</h3>
            <div class="chart-container"><canvas id="dietChart"></canvas></div>
        </div>

        <div class="glass-card p-8 md:col-span-2" data-aos="fade-up">
            <h3 class="text-2xl font-bold mb-4 flex items-center">ğŸ“ æœ€æ–°æ„è¦‹å›é¥‹</h3>
            <div id="commentList" class="space-y-3 max-h-60 overflow-y-auto pr-2 text-blue-50"></div>
        </div>
    </div>

    <script>
        // âš ï¸ è«‹ç¢ºä¿æ­¤ç¶²å€åœ¨ç€è¦½å™¨èƒ½ç›´æ¥ä¸‹è¼‰ CSV
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxj6-BEjCk5-VqEgMdY1q8YUZYQb2HKnB3l6ZViTVdKf1_RtUIrEqU7uxeXZhQ_PoormenvfhZ4r5b/pub?output=csv';

        // ğŸ’¡ å‚™ç”¨è³‡æ–™ï¼šå¦‚æœé€£ä¸åˆ° Googleï¼Œå°±è·‘é€™å€‹ï¼ˆç¢ºä¿ç¶²é ä¸ç©ºç™½ï¼‰
        const fallbackData = [
            { "å¹´ç´š": "å¤§ä¸€", "é£²é£Ÿç¿’æ…£": "è‘·é£Ÿ", "å‚™è¨»": "ç¯„ä¾‹è³‡æ–™ï¼šå¥½æƒ³å–çå¥¶" },
            { "å¹´ç´š": "å¤§äºŒ", "é£²é£Ÿç¿’æ…£": "ç´ é£Ÿ", "å‚™è¨»": "ç¯„ä¾‹è³‡æ–™ï¼šå¾®å†°å¾®ç³–" },
            { "å¹´ç´š": "å¤§ä¸‰", "é£²é£Ÿç¿’æ…£": "ä¸åƒç‰›", "å‚™è¨»": "ç¯„ä¾‹è³‡æ–™ï¼šä»Šå¤©å¤©æ°£ä¸éŒ¯" }
        ];

        async function init() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) throw new Error('Network response was not ok');
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    complete: (results) => startApp(results.data)
                });
            } catch (error) {
                console.warn("ç„¡æ³•é€£æ¥ Google è¡¨å–®ï¼Œå•Ÿå‹•æ¼”ç¤ºæ¨¡å¼:", error);
                document.getElementById('status-tag').textContent = "æ¼”ç¤ºæ¨¡å¼ (é€£ç·šå¤±æ•—)";
                document.getElementById('status-tag').classList.replace('bg-green-500', 'bg-orange-500');
                startApp(fallbackData);
            }
        }

        function startApp(data) {
            const gradeCounts = {};
            const dietCounts = {};
            const comments = [];

            data.forEach(row => {
                if (row['å¹´ç´š']) gradeCounts[row['å¹´ç´š']] = (gradeCounts[row['å¹´ç´š']] || 0) + 1;
                if (row['é£²é£Ÿç¿’æ…£']) {
                    row['é£²é£Ÿç¿’æ…£'].split(',').forEach(d => {
                        const item = d.trim();
                        dietCounts[item] = (dietCounts[item] || 0) + 1;
                    });
                }
                if (row['å‚™è¨»']) comments.push(row['å‚™è¨»']);
            });

            renderCharts(gradeCounts, dietCounts);
            renderComments(comments);
            
            // æœ€å¾Œæ‰å•Ÿå‹•å‹•ç•«
            AOS.init({ duration: 1000, once: true });
        }

        function renderCharts(gradeData, dietData) {
            new Chart(document.getElementById('gradeChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gradeData),
                    datasets: [{
                        data: Object.values(gradeData),
                        backgroundColor: ['#4ade80', '#60a5fa', '#fbbf24', '#f87171'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: 'white' } } } }
            });

            new Chart(document.getElementById('dietChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(dietData),
                    datasets: [{
                        label: 'äººæ•¸',
                        data: Object.values(dietData),
                        backgroundColor: 'rgba(255, 255, 255, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: 'white' } }
                    }
                }
            });
        }

        function renderComments(comments) {
            const container = document.getElementById('commentList');
            container.innerHTML = comments.map(c => 
                `<div class="bg-white bg-opacity-10 p-3 rounded-lg border-l-4 border-yellow-400">"${c}"</div>`
            ).join('');
        }

        window.onload = init;
    </script>
</body>
</html>