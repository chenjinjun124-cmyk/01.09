<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²æ–™å–œå¥½æ•¸æ“šåˆ†æå„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }
        .glass-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 1.5rem; }
        .chart-container { position: relative; height: 300px; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto text-center mb-10">
        <h1 class="text-4xl font-bold mb-2">ğŸ¥¤ å­¸ç”Ÿé£²æ–™å–œå¥½æ•¸æ“šåˆ†æ</h1>
        <div id="status" class="inline-block px-3 py-1 rounded-full bg-green-500 text-sm">æ•¸æ“šå³æ™‚é€£ç·šä¸­</div>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="glass-card p-8" data-aos="fade-up">
            <h3 class="text-xl font-bold mb-4">ğŸ“Š å°±è®€å¹´ç´šåˆ†ä½ˆ</h3>
            <div class="chart-container"><canvas id="gradeChart"></canvas></div>
        </div>

        <div class="glass-card p-8" data-aos="fade-up" data-aos-delay="200">
            <h3 class="text-xl font-bold mb-4">ğŸ¹ æœ€å–œæ­¡çš„é£²å“é¡åˆ¥</h3>
            <div class="chart-container"><canvas id="drinkChart"></canvas></div>
        </div>

        <div class="glass-card p-8 md:col-span-2" data-aos="fade-up">
            <h3 class="text-xl font-bold mb-4">ğŸ“ æœ€æ–°æ„è¦‹ (ç¿’æ…£ç”œåº¦æ‘˜è¦)</h3>
            <div id="commentList" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <script>
        // åŠ å…¥æ™‚é–“æˆ³è¨˜å¼·åˆ¶åˆ·æ–°ï¼Œç¢ºä¿ä¸è®€å–èˆŠè³‡æ–™
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxj6-BEjCk5-VqEgMdY1q8YUZYQb2HKnB3l6ZViTVdKf1_RtUIrEqU7uxeXZhQ_PoormenvfhZ4r5b/pub?output=csv' + '&t=' + Date.now();

        async function init() {
            try {
                const res = await fetch(CSV_URL);
                const text = await res.text();
                Papa.parse(text, {
                    header: true,
                    complete: (results) => processRealData(results.data)
                });
            } catch (e) {
                document.getElementById('status').className = "bg-red-500 px-3 py-1 rounded-full text-sm";
                document.getElementById('status').innerText = "é€£ç·šå¤±æ•—";
            }
        }

        function processRealData(data) {
            const grades = {};
            const drinks = {};
            const sugars = [];

            data.forEach(row => {
                // ç²¾æº–åŒ¹é…ä½ æˆªåœ–ä¸­çš„æ¨™é¡Œåç¨±
                const g = row['2. å°±è®€å¹´ç´š'];
                const d = row['8. æœ€å–œæ­¡çš„é£²å“é¡åˆ¥ï¼'];
                const s = row['9. ç¿’æ…£çš„ç”œåº¦'];

                if (g) grades[g] = (grades[g] || 0) + 1;
                if (d) drinks[d] = (drinks[d] || 0) + 1;
                if (s) sugars.push(s);
            });

            renderCharts(grades, drinks);
            renderSugarTags(sugars);
            AOS.init({ duration: 1000 });
        }

        function renderCharts(gradeData, drinkData) {
            // å¹´ç´šåœ–è¡¨
            new Chart(document.getElementById('gradeChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(gradeData),
                    datasets: [{ data: Object.values(gradeData), backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: 'white' } } } }
            });

            // é£²å“åœ–è¡¨
            new Chart(document.getElementById('drinkChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(drinkData),
                    datasets: [{ label: 'äººæ•¸', data: Object.values(drinkData), backgroundColor: 'rgba(255, 255, 255, 0.7)' }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { ticks: { color: 'white' } }, x: { ticks: { color: 'white' } } }
                }
            });
        }

        function renderSugarTags(sugars) {
            const list = document.getElementById('commentList');
            list.innerHTML = sugars.map(s => `<div class="bg-white/10 p-2 rounded text-center border border-white/20">${s}</div>`).join('');
        }

        window.onload = init;
    </script>
</body>
</html>
